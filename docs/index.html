<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interaction with "RevBayes" in R • Revticulate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interaction with " revbayes in r>
<meta property="og:description" content='Interaction with "RevBayes" via R. Objects created in "RevBayes" can be passed into the R environment, and many types can be converted into similar R objects. To download "RevBayes", go to &lt;https://revbayes.github.io/download&gt;.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">Revticulate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/BasicTutorial.html">Usage of Revticulate</a>
    </li>
    <li>
      <a href="articles/DiscreteMorphology.html">Discrete morphology example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="revticulate">Revticulate<a class="anchor" aria-label="anchor" href="#revticulate"></a>
</h1></div>
<div class="section level2">
<h2 id="an-r-package-for-interacting-with-revbayes-from-r-and-rstudio">An R package for interacting with RevBayes from R and RStudio<a class="anchor" aria-label="anchor" href="#an-r-package-for-interacting-with-revbayes-from-r-and-rstudio"></a>
</h2>
</div>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>Revticulate can be installed in two ways. The first is via CRAN, using the default <code>install.packages</code> function in R:</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Revticulate"</span><span class="op">)</span></code></pre>
<p>The second is via the remotes package, a lightweight package enabling installation from GitHub repositories.</p>
<pre class="{r}"><code><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"revbayes/Revticulate"</span><span class="op">)</span></code></pre>
<p>The GitHub repository for Revticulate contains cutting-edge features and may contain bugfixes, but the CRAN is known to be stable for everyday use.</p>
<p>Upon first installation, Revticulate will run a package check.<br>
This check searches for and .Renviron file that contains a RevBayes path. If the package doesn’t find this file, or finds it without the path, the package prompts the user to use <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>. This opens the .Renviron file, and the user will enter <code>rb={absolute path to revbayes}</code>. This can be edited at any time if there are multiple installs on the system, or if you recompile RevBayes and want to use a new version.</p>
<p>Before using Revticulate in knitr, make sure the following is in your setup chunk:</p>
<pre><code><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Revticulate</span><span class="op">)</span>
<span class="fu"><a href="reference/knitRev.html">knitRev</a></span><span class="op">(</span><span class="op">)</span></code></pre>
<div class="section level2">
<h2 id="using-revbayes-in-a-knitr-chunk">Using RevBayes in a KnitR Chunk<a class="anchor" aria-label="anchor" href="#using-revbayes-in-a-knitr-chunk"></a>
</h2>
<p>RevBayes can be used in a KnitR chunk by changing the header to <code>rb</code> instead of <code>r</code>. In the below chunk, we create an object called <code>example</code> and use the assignment operator to give it the value 1. Then we print it.</p>
<pre><code><span class="va">example</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>
<span class="va">example</span></code></pre>
<p>This is not an overtly useful thing to do, however. Let’s erase the previous chunk using the <code><a href="reference/clearRev.html">clearRev()</a></code> function. This removes prior code from the RevBayes environment. Very handy if you make a mistake!</p>
<pre><code><span class="fu"><a href="reference/clearRev.html">clearRev</a></span><span class="op">(</span><span class="op">)</span></code></pre>
<p>We could, instead, choose to do something a little more useful. How about reading in a data matrix and making a quick starting tree?</p>
<pre><code><span class="va">morpho</span> <span class="op">&lt;-</span> <span class="fu">readDiscreteCharacterData</span><span class="op">(</span><span class="st">"bears.nex"</span><span class="op">)</span>
<span class="va">num_taxa</span> <span class="op">&lt;-</span> <span class="fu">morpho.size</span><span class="op">(</span><span class="op">)</span>
<span class="va">num_branches</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">num_taxa</span> <span class="op">-</span> <span class="fl">2</span>
<span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu">morpho.names</span><span class="op">(</span><span class="op">)</span>
<span class="va">br_len_lambda</span> <span class="op">~</span> <span class="fu">dnExp</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="va">phylogeny</span> <span class="op">~</span> <span class="fu">dnUniformTopologyBranchLength</span><span class="op">(</span><span class="va">taxa</span>, branchLengthDistribution<span class="op">=</span><span class="fu">dnExponential</span><span class="op">(</span><span class="va">br_len_lambda</span><span class="op">)</span><span class="op">)</span>
<span class="va">phylogeny</span></code></pre>
<p>Anything entered in an <code>rb</code> block will be interpreted as Rev code, and all the normal Rev syntax will apply. For a nice overview of Rev language and syntax, please see <a href="https://revbayes.github.io/tutorials/intro/rev" class="external-link">this tutorial</a>.</p>
<p>One thing researchers are often interested in doing is making an object in Rev and then viewing it in R. The best way to accomplish this is with the <code><a href="reference/doRev.html">doRev()</a></code> function. When using this function, the RevCode you’d like to run goes in the parentheses of the <code>doRev</code> function. These are then exportable to R. In this example, we load the dataset used in the published tutorial “Estimating a time-calibrated phylogeny of fossil and extant taxa using RevBayes” {@barido2020estimating}.</p>
<pre><code><span class="fu"><a href="reference/doRev.html">doRev</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">'morpho &lt;- readDiscreteCharacterData("bears.nex")
num_taxa &lt;- morpho.size()
num_branches &lt;- 2 * num_taxa - 2
taxa &lt;- morpho.names()
br_len_lambda ~ dnExp(0.2)
phylogeny ~ dnUniformTopologyBranchLength(taxa, branchLengthDistribution=dnExponential(br_len_lambda))
phylogeny'</span><span class="op">)</span></code></pre>
<p>The <code>doRev</code> function is then used to extract the object. Note that knitr chunks can only have one language type. Thus, to use a Rev Object in another chunk, it must be exported. In this case, a phylogeny is not a simple numeric type, and Revticualte automates the coercion from a string to a Newick tree that can be read by Phytools or similar.</p>
<pre><code><span class="va">phylogeny</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/doRev.html">doRev</a></span><span class="op">(</span><span class="st">"phylogeny"</span><span class="op">)</span>

<span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotTree.html" class="external-link">plotTree</a></span><span class="op">(</span><span class="va">phylogeny</span><span class="op">)</span></code></pre>
<p>We may choose to clear RevBayes objects out of memory so that they are not being consistently echoed to the screen.</p>
<pre><code><span class="fu"><a href="reference/clearRev.html">clearRev</a></span><span class="op">(</span><span class="op">)</span></code></pre>
<p>One nice facet of having RevBayes running in an R notebook is the ability to flip to visualizations of the different distributions we use. For example, here is the code for a common parameterization of the discrete Gamma distribution on site rates.</p>
<pre><code><span class="va">alpha_morpho</span> <span class="op">~</span> <span class="fu">dnUniform</span><span class="op">(</span> <span class="fl">0</span>, <span class="fl">1E6</span> <span class="op">)</span>;
<span class="va">rates_morpho</span> <span class="op">:=</span> <span class="fu">fnDiscretizeGamma</span><span class="op">(</span> <span class="va">alpha_morpho</span>, <span class="va">alpha_morpho</span>, <span class="fl">4</span> <span class="op">)</span>
<span class="va">alpha_morpho</span></code></pre>
<p>If you aren’t a big stats person, this might not mean much to you, in terms of what this distribution actually looks like. But it is important to develop intuitions for what common distributions look like and what this says about our data. So, we can use R’s built-in graphics capabilities to have a look at what 1000 draws from this gamma will look like.</p>
<pre><code><span class="fu"><a href="reference/doRev.html">doRev</a></span><span class="op">(</span><span class="st">'alpha_morpho ~ dnUniform( 0, 1E6 );
rates_morpho := fnDiscretizeGamma( alpha_morpho, alpha_morpho, 4 )
'</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="va">alpha_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/doRev.html">doRev</a></span><span class="op">(</span><span class="st">"alpha_morpho"</span><span class="op">)</span>
<span class="va">alpha_value</span>

<span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, shape <span class="op">=</span> <span class="va">alpha_value</span>, rate <span class="op">=</span> <span class="va">alpha_value</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">draws</span>, xlab <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></code></pre>
<div class="section level3">
<h3 id="simulate-coin-flips">Simulate coin flips<a class="anchor" aria-label="anchor" href="#simulate-coin-flips"></a>
</h3>
<p>It’s adviseable if you’re switching gears to a new activity to clear the Rev environment of workspace objects from old activities:</p>
<pre><code><span class="fu"><a href="reference/clearRev.html">clearRev</a></span><span class="op">(</span><span class="op">)</span></code></pre>
<p>Note that <code>clearRev</code> is an R function, and must be executed in an R chunk.</p>
<pre><code><span class="co"># The number of coin flips</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>

<span class="co"># The number of heads</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">x</span></code></pre>
</div>
<div class="section level3">
<h3 id="initialize-markov-chain">Initialize Markov Chain<a class="anchor" aria-label="anchor" href="#initialize-markov-chain"></a>
</h3>
<p>We have to start MCMC off with some initial parameter values. One way to do this is to randomly draw values of the parameter (<span class="math inline"><em>p</em></span>) from the prior distribution. We assume a flat beta prior distribution (<span class="math inline"><em>α</em> = 1</span> and <span class="math inline"><em>β</em> = 1</span>).</p>
<pre><code><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span> <span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span> <span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">p</span></code></pre>
</div>
<div class="section level3">
<h3 id="likelihood-function">Likelihood Function<a class="anchor" aria-label="anchor" href="#likelihood-function"></a>
</h3>
<p>We next specify the likelihood function. We use the binomial probability for the likelihood function. Since the likelihood is defined only for <span class="math inline"><em>p</em></span> between 0 and 1, we return 0 if <span class="math inline"><em>p</em></span> is outside this range.</p>
<p><code>{rb include=FALSE} function likelihood(p) {     if(p &lt; 0 || p &gt; 1)         return 0     l&lt;-dbinomial(x,p,n,log=false)     return l }</code></p>
<p>The function can then be executed in the next cell:</p>
<pre><code><span class="fu">likelihood</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="the-reprev-environment">The RepRev() environment<a class="anchor" aria-label="anchor" href="#the-reprev-environment"></a>
</h2>
<p>The function <code><a href="reference/repRev.html">repRev()</a></code> can be called in the console (or in non-RStudio versions of R) to use RevBayes directly to program interactively. The <code><a href="reference/repRev.html">repRev()</a></code> environment is denoted with <code>rb&gt;&gt;&gt;</code>. To exit, type Ctrl + C. It is not compatible with KnitR, being a console tool.</p>
<pre><code><span class="co"># repRev()</span>

<span class="co"># rb&gt;&gt;&gt; 1+2</span>

<span class="co"># [1] 3</span></code></pre>
</div>
<div class="section level2">
<h2 id="running-long-computations">Running Long Computations<a class="anchor" aria-label="anchor" href="#running-long-computations"></a>
</h2>
<p>Perhaps we would like to run a longer computation from R using Revticulate. For example, maybe we have made an MCMC script, and would like to run it using Revticulate, and then automatically process the output in R. In the below example, we will run an MCMC and automatically evaluate it for convergence using the package conveience.</p>
<p>Included with the package, we have a script called ‘mcmc_mk.Rev,’ which runs a short phylogenetic estimation for a small morphological dataset from bears using the Mk model {@Lewis2001}. Once the computation is complete, convergence is diagnosed with the R package convenience {@fabreti2021}. Please note that this will take about 5 minutes if executed.</p>
<pre><code><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">convenience</span><span class="op">)</span>
<span class="fu"><a href="reference/callRevFromTerminal.html">callRevFromTerminal</a></span><span class="op">(</span><span class="st">"mcmc_mk.Rev"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/convenience/man/checkConvergence.html" class="external-link">checkConvergence</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"vignettes/output/"</span><span class="op">)</span></code></pre>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=Revticulate" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Revticulate</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Caleb Charpentier <br><small class="roles"> Author, maintainer </small>  </li>
<li>April Wright <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Caleb Charpentier, April Wright.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
